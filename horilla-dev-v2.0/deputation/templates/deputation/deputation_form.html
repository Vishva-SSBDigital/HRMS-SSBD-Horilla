{% comment %} {% load i18n %}
{% load static %}

<div class="oh-modal__dialog-header">
  <span class="oh-modal__dialog-title">
    <h5 class="m-0">
      {% if is_update %}{% trans "Amend Deputation" %}{% else %}{% trans "Create Deputation" %}{% endif %}
    </h5>
  </span>
  <button type="button" class="oh-modal__close" data-toggle="oh-modal-toggle" data-dismiss="oh-modal" aria-label="Close">
    <ion-icon name="close-outline"></ion-icon>
  </button>
</div>

<div class="oh-modal__dialog-body">
  <form
    method="post"
    class="oh-form"
    action="{% if is_update %}{% url 'deputation-update' instance.id %}{% else %}{% url 'deputation-create' %}{% endif %}"
    >
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="oh-alert oh-alert--danger oh-alert--animated" style="margin-bottom:12px;">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    <div class="oh-grid oh-grid--2">
      <div class="oh-input-group">
        <label class="oh-label">{{ form.employee.label }}</label>
        {{ form.employee }}
        {% for e in form.employee.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.designation.label }}</label>
        {{ form.designation }}
        {% for e in form.designation.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.original_branch.label }}</label>
        {{ form.original_branch }}
        {% for e in form.original_branch.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.deputed_to.label }}</label>
        {{ form.deputed_to }}
        {% for e in form.deputed_to.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.start_date.label }}</label>
        {{ form.start_date }}
        {% for e in form.start_date.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.end_date.label }}</label>
        {{ form.end_date }}
        {% for e in form.end_date.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.email.label }}</label>
        {{ form.email }}
        {% for e in form.email.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.current_position.label }}</label>
        {{ form.current_position }}
        {% for e in form.current_position.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>
    </div>

    <div class="oh-modal__dialog-footer mt-2">
      <button type="submit" class="oh-btn oh-btn--secondary oh-btn--shadow">{% trans "Save" %}</button>
      <button type="button" class="oh-btn oh-btn--light" data-toggle="oh-modal-toggle" data-dismiss="oh-modal">{% trans "Cancel" %}</button>
    </div>
  </form>
</div> {% endcomment %} 

{% comment %} {% load i18n %}
{% load static %}

<div class="oh-modal__dialog-header">
  <span class="oh-modal__dialog-title">
    <h5 class="m-0">
      {% if is_update %}{% trans "Amend Deputation" %}{% else %}{% trans "Create Deputation" %}{% endif %}
    </h5>
  </span>
  <button type="button" class="oh-modal__close" data-toggle="oh-modal-toggle" data-dismiss="oh-modal" aria-label="Close">
    <ion-icon name="close-outline"></ion-icon>
  </button>
</div>

<div class="oh-modal__dialog-body">
  <form
    method="post"
    class="oh-form"
    action="{% if is_update %}{% url 'deputation-update' instance.id %}{% else %}{% url 'deputation-create' %}{% endif %}"
  >
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="oh-alert oh-alert--danger oh-alert--animated" style="margin-bottom:12px;">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    <div class="oh-grid oh-grid--2">
      <div class="oh-input-group">
        <label class="oh-label">{{ form.employee.label }}</label>
        {{ form.employee }}
        {% for e in form.employee.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.designation.label }}</label>
        {{ form.designation }}
        {% for e in form.designation.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.original_branch.label }}</label>
        {{ form.original_branch }}
        {% for e in form.original_branch.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.deputed_to.label }}</label>
        {{ form.deputed_to }}
        {% for e in form.deputed_to.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.start_date.label }}</label>
        {{ form.start_date }}
        {% for e in form.start_date.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.end_date.label }}</label>
        {{ form.end_date }}
        {% for e in form.end_date.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.email.label }}</label>
        {{ form.email }}
        {% for e in form.email.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.current_position.label }}</label>
        {{ form.current_position }}
        {% for e in form.current_position.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>
    </div>
  

    <div class="oh-modal__dialog-footer mt-2">
      <button type="submit" class="oh-btn oh-btn--secondary oh-btn--shadow">{% trans "Save" %}</button>
      <button type="button" class="oh-btn oh-btn--light" data-toggle="oh-modal-toggle" data-dismiss="oh-modal">{% trans "Cancel" %}</button>
    </div>
  </form>
</div> {% endcomment %}
{% load i18n static %}

{% comment %} <div class="oh-modal__dialog-header"> ... </div>

<div class="oh-modal__dialog-body" id="DeputationModalTarget">
  <form method="post" class="oh-form"
        hx-post="{% if is_update %}{% url 'deputation-update' instance.id %}{% else %}{% url 'deputation-create' %}{% endif %}"
        hx-target="#DeputationModalTarget"
        hx-swap="innerHTML">
    {% csrf_token %}

   <div class="oh-input-group">
  <label class="oh-label">{{ form.employee.label }}</label>
  {# The select already has hx-* attrs in forms.py; just render it #}
  {{ form.employee }}
</div>

{# This is the ONLY place those 4 fields live initially #}
<div id="employee-details" class="oh-grid oh-grid--2" style="grid-column:1/-1;">
  <div class="oh-input-group">
    <label class="oh-label">{{ form.designation.label }}</label>
    {{ form.designation }}
  </div>
  <div class="oh-input-group">
    <label class="oh-label">{{ form.original_branch.label }}</label>
    {{ form.original_branch }}
  </div>
  <div class="oh-input-group">
    <label class="oh-label">{{ form.email.label }}</label>
    {{ form.email }}
  </div>
  <div class="oh-input-group">
    <label class="oh-label">{{ form.current_position.label }}</label>
    {{ form.current_position }}
  </div>
</div>


    <div class="oh-modal__dialog-footer mt-2">
      <button type="submit" class="oh-btn oh-btn--secondary oh-btn--shadow">{% trans "Save" %}</button>
      <button type="button" class="oh-btn oh-btn--light" data-toggle="oh-modal-toggle" data-dismiss="oh-modal">{% trans "Cancel" %}</button>
    </div>
  </form>
</div> {% endcomment %}
{# deputation/deputation_form.html #}
{% comment %} <div class="oh-modal__dialog-body" id="DeputationModalTarget">
  <form
    method="post"
    class="oh-form"
    hx-post="{% if is_update %}{% url 'deputation-update' instance.id %}{% else %}{% url 'deputation-create' %}{% endif %}"
    hx-target="#DeputationModalTarget"
    hx-swap="innerHTML"
  >
    {% csrf_token %}

    <div class="oh-grid oh-grid--2">
      {# Employee select (HTMX attrs are set in forms.py) #}
      <div class="oh-input-group">
        <label class="oh-label">{{ form.employee.label }}</label>
        {{ form.employee }}
        {% for e in form.employee.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      {# Auto-filled details (HTMX replaces innerHTML of this wrapper) #}
      <div id="employee-details" class="oh-grid oh-grid--2" style="grid-column:1/-1;">
        <div class="oh-input-group">
          <label class="oh-label">{{ form.designation.label }}</label>
          {{ form.designation }}
          {% for e in form.designation.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
        </div>

        <div class="oh-input-group">
          <label class="oh-label">{{ form.original_branch.label }}</label>
          {{ form.original_branch }}
          {% for e in form.original_branch.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
        </div>

        <div class="oh-input-group">
          <label class="oh-label">{{ form.email.label }}</label>
          {{ form.email }}
          {% for e in form.email.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
        </div>

        <div class="oh-input-group">
          <label class="oh-label">{{ form.current_position.label }}</label>
          {{ form.current_position }}
          {% for e in form.current_position.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
        </div>
      </div>

      {# Per-deputation fields (user fills these) #}
      <div class="oh-input-group">
        <label class="oh-label">{{ form.deputed_to.label }}</label>
        {{ form.deputed_to }}
        {% for e in form.deputed_to.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.start_date.label }}</label>
        {{ form.start_date }}
        {% for e in form.start_date.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.end_date.label }}</label>
        {{ form.end_date }}
        {% for e in form.end_date.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>
    </div>

    <div class="oh-modal__dialog-footer mt-2">
      <button type="submit" class="oh-btn oh-btn--secondary oh-btn--shadow">{% trans "Save" %}</button>
      <button type="button" class="oh-btn oh-btn--light" data-toggle="oh-modal-toggle" data-dismiss="oh-modal">{% trans "Cancel" %}</button>
    </div>
  </form>
</div> {% endcomment %}



{% comment %} <div class="oh-modal__dialog-body" id="DeputationModalTarget">
  <form
    method="post"
    class="oh-form"
    hx-post="{% if is_update %}{% url 'deputation-update' instance.id %}{% else %}{% url 'deputation-create' %}{% endif %}"
    hx-target="#DeputationModalTarget"
    hx-swap="innerHTML"
  >
    {% csrf_token %}
    

    <div class="oh-grid oh-grid--2">
      {# Employee select (HTMX attrs are set in forms.py) #}
      <div class="oh-input-group">
        <label class="oh-label">{{ form.employee.label }}</label>
        {{ form.employee }} {% for e in form.employee.errors %}
        <div class="oh-input__error">{{ e }}</div>
        {% endfor %}
      </div>

      {# Auto-filled details (HTMX replaces innerHTML of this wrapper) #}
      <div
        id="employee-details"
        class="oh-grid oh-grid--2"
        style="grid-column: 1/-1"
      >
        <div class="oh-input-group">
          <label class="oh-label">{{ form.designation.label }}</label>
          {{ form.designation }} {% for e in form.designation.errors %}
          <div class="oh-input__error">{{ e }}</div>
          {% endfor %}
        </div>

        <div class="oh-input-group">
          <label class="oh-label">{{ form.original_branch.label }}</label>
          {{ form.original_branch }} {% for e in form.original_branch.errors %}
          <div class="oh-input__error">{{ e }}</div>
          {% endfor %}
        </div>

        <div class="oh-input-group">
          <label class="oh-label">{{ form.email.label }}</label>
          {{ form.email }} {% for e in form.email.errors %}
          <div class="oh-input__error">{{ e }}</div>
          {% endfor %}
        </div>

        <div class="oh-input-group">
          <label class="oh-label">{{ form.current_position.label }}</label>
          {{ form.current_position }} {% for e in form.current_position.errors %}
          <div class="oh-input__error">{{ e }}</div>
          {% endfor %}
        </div>
      </div>

      {# Per-deputation fields (user fills these) #}
      <div class="oh-input-group">
        <label class="oh-label">{{ form.deputed_to.label }}</label>
        {{ form.deputed_to }} {% for e in form.deputed_to.errors %}
        <div class="oh-input__error">{{ e }}</div>
        {% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.start_date.label }}</label>
        {{ form.start_date }} {% for e in form.start_date.errors %}
        <div class="oh-input__error">{{ e }}</div>
        {% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.end_date.label }}</label>
        {{ form.end_date }} {% for e in form.end_date.errors %}
        <div class="oh-input__error">{{ e }}</div>
        {% endfor %}
      </div>
    </div>

    <div class="oh-modal__dialog-footer mt-2">
      <button type="submit" class="oh-btn oh-btn--secondary oh-btn--shadow">
        {% trans "Save" %}
      </button>
      <button
        type="button"
        class="oh-btn oh-btn--light"
        id="cancelButton"
      >
        {% trans "Cancel" %}
      </button>
    </div>
  </form>
</div>

<script>
  // JavaScript to close the modal when cancel button is clicked
  document.getElementById('cancelButton')?.addEventListener('click', function() {
    const modal = document.getElementById('DeputationModal');
    if (modal) {
      modal.style.display = 'none';  // Hide the modal
    }
  });
</script> {% endcomment %}

{% comment %} #changes {% endcomment %}
<div class="oh-modal__dialog-body" id="DeputationModalTarget">
  <form
    method="post"
    class="oh-form"
    hx-post="{% if is_update %}{% url 'deputation-update' instance.id %}{% else %}{% url 'deputation-create' %}{% endif %}"
    hx-target="#DeputationModalTarget"
    hx-swap="innerHTML"
  >
    {% csrf_token %}

    <div class="oh-grid oh-grid--2">
      {# Employee select (HTMX attrs are set in forms.py) #}
      <div class="oh-input-group">
        <label class="oh-label">{{ form.employee.label }}</label>
        {{ form.employee }}
        {% for e in form.employee.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      {# NEW: Department dropdown (manual) #}
      <div class="oh-input-group">
        <label class="oh-label">{{ form.department.label }}</label>
        {{ form.department }}
        {% for e in form.department.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      {# NEW: Deputed Designation dropdown (manual) #}
      <div class="oh-input-group" style="grid-column:1/-1">
        <label class="oh-label">{{ form.deputed_designation.label }}</label>
        {{ form.deputed_designation }}
        {% for e in form.deputed_designation.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>
      <input type="hidden" name="designation" id="id_designation_hidden" value="{{ form.designation.value|default_if_none:'' }}">
      {# Auto-filled details (HTMX replaces innerHTML of this wrapper) #}
      <div id="employee-details" class="oh-grid oh-grid--2" style="grid-column: 1/-1">
        <div class="oh-input-group">
          <label class="oh-label">{{ form.original_branch.label }}</label>
          {{ form.original_branch }}
          {% for e in form.original_branch.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
        </div>

        <div class="oh-input-group">
          <label class="oh-label">{{ form.email.label }}</label>
          {{ form.email }}
          {% for e in form.email.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
        </div>

        <div class="oh-input-group">
          <label class="oh-label">{{ form.current_position.label }}</label>
          {{ form.current_position }}
          {% for e in form.current_position.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
        </div>
      </div>

      {# Per-deputation fields (user fills these) #}
      <div class="oh-input-group">
        <label class="oh-label">{{ form.deputed_to.label }}</label>
        {{ form.deputed_to }}
        {% for e in form.deputed_to.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.start_date.label }}</label>
        {{ form.start_date }}
        {% for e in form.start_date.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>

      <div class="oh-input-group">
        <label class="oh-label">{{ form.end_date.label }}</label>
        {{ form.end_date }}
        {% for e in form.end_date.errors %}<div class="oh-input__error">{{ e }}</div>{% endfor %}
      </div>
    </div>

    <div class="oh-modal__dialog-footer mt-2">
      <button type="submit" class="oh-btn oh-btn--secondary oh-btn--shadow">{% trans "Save" %}</button>
      <button type="button" class="oh-btn oh-btn--light" id="cancelButton">{% trans "Cancel" %}</button>
    </div>
  </form>
</div>
<script>
  function closeDeputationModal() {
    const modal = document.getElementById('DeputationModal');
    if (modal) modal.style.display = 'none';
    // If Bootstrap modal: $('#DeputationModal').modal('hide');
  }

  // Listen for HTMX triggers sent from views.py (created/updated)
  document.body.addEventListener("deputation:created", function() {
    closeDeputationModal();
    // reload list region or full page
    if (window.htmx) {
      htmx.ajax('GET', "{% url 'deputation-list' %}", { target: '#DeputationList', swap: 'innerHTML' });
    } else {
      location.reload();
    }
  });

  document.body.addEventListener("deputation:updated", function() {
    closeDeputationModal();
    if (window.htmx) {
      htmx.ajax('GET', "{% url 'deputation-list' %}", { target: '#DeputationList', swap: 'innerHTML' });
    } else {
      location.reload();
    }
  });
</script>


<script>
  document.getElementById('cancelButton')?.addEventListener('click', function() {
    const modal = document.getElementById('DeputationModal');
    if (modal) modal.style.display = 'none';
  });
</script>
