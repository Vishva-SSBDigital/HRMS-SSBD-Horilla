{% load static i18n %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Promotion Management</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
</head>
<body class="bg-light">
<div class="container py-4">
  <h3 class="mb-3">Promotion Management</h3>

  <form id="promotion-form" method="post" action="" class="card shadow-sm">
    <div class="card-body">
      {% csrf_token %}

      <!-- Row: Employee Id + Fetch -->
      <div class="row g-2 align-items-end mb-3">
        <div class="col-12 col-md-4">
          <label class="form-label">Employee Id</label>
          <input type="text" name="employee_id" id="id_employee_id" class="form-control" placeholder="EMP001">
        </div>
        <div class="col-auto">
          <button type="button"
                  class="btn btn-primary"
                  hx-get="{% url 'promotion:employee_lookup' %}"
                  hx-target="#employee-block"
                  hx-include="#promotion-form"
                  hx-vals='js:{employee_id: document.getElementById("id_employee_id").value}'>
            Fetch
          </button>
        </div>
      </div>

      <!-- Hidden real FK -->
      {{ form.employee }}

      <!-- Fetched block (Name, Current Status, Current Designation, Leave) -->
      <div id="employee-block" class="mb-3">
        <!-- filled by _employee_fetch_result.html -->
      </div>

      <label class="form-label">Proposed Employee Status</label>
        {{ form.proposed_status }}

        <label class="form-label">Proposed Employee New Grade/Designation</label>
        {{ form.proposed_designation }}


      <!-- Current leave snapshot (disabled inputs already rendered in fetch result) -->
      {{ form.current_status }} {{ form.current_designation }}
      {{ form.current_cl }} {{ form.current_pl }} {{ form.current_sl }}

      <!-- Auto-calculated proposal (salary + adjusted leaves) -->
      <div id="proposal-fields" class="mt-3">
        {% include "promotion/_proposal_fields.html" with adjusted=None proposed_basic=None %}
      </div>

      <div class="row g-3 mt-2">
        <div class="col-md-4">
          <label class="form-label">Promotion Effective From</label>
          {{ form.effective_from }}
        </div>
      </div>
    </div>

    <div class="card-footer d-flex gap-2">
      <button class="btn btn-success" type="submit">Submit</button>
    </div>
  </form>
</div>

<script>
  // helper to add Bootstrap classes to Django widgets (if using django-widget-tweaks, you can remove this)
  NodeList.prototype.forEach = Array.prototype.forEach;
</script>
</body>
</html>
